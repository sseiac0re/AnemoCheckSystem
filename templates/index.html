{% extends "base.html" %}

{% block title %}AnemoCheck - Home{% endblock %}

{% block content %}
<!-- Import Poppins Font -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
/* ðŸŒˆ Global Font */
body, h1, h2, h3, h4, h5, h6, p, label, a, button {
    font-family: 'Poppins', sans-serif;
}

/* ðŸŒˆ Modern Clean Hero Design */
.hero-section {
    background: linear-gradient(to right, #f8fafc, #eef2f7);
    border-radius: 20px;
    padding: 4rem 3rem;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: space-between;
    gap: 2rem;
}
.hero-text {
    flex: 1;
    min-width: 300px;
    padding-right: 2rem;
}
.hero-text h2 {
    font-weight: 700;
    font-size: 2.8rem;
    color: #182848;
}
.text-anemo-red {
    color: #f94144;
}
.hero-text p {
    font-size: 1.15rem;
    line-height: 1.6;
    color: #4a5568;
}
.hero-img {
    flex: 1;
    min-width: 300px;
    text-align: center;
}
.hero-img img {
    width: 100%;
    max-width: 480px;
    border-radius: 20px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}
.card-modern {
    border: none;
    border-radius: 18px;
    transition: all 0.3s ease;
}
.card-modern:hover {
    transform: translateY(-6px);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
}
.btn-primary {
    background: linear-gradient(90deg, #4b6cb7, #182848);
    border: none;
    transition: all 0.3s ease;
}
.btn-primary:hover {
    background: linear-gradient(90deg, #182848, #4b6cb7);
    transform: scale(1.05);
}
.btn-outline-primary:hover {
    background-color: #4b6cb7;
    color: white;
}

/* ðŸ’Ž Card Images - Fixed Height & Uniform */
.feature-image {
    width: 100%;
    height: 200px;
    border-radius: 15px;
    margin-bottom: 1rem;
    object-fit: cover;
}

/* ðŸ”¹ Navbar Active Highlight */
.nav-link.active {
    color: #182848 !important;
    font-weight: 600;
    border-bottom: 3px solid #4b6cb7;
}
.nav-link:hover {
    color: #4b6cb7 !important;
}
</style>

<!-- âœ… Add Active Highlight for Navigation -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const currentPath = window.location.pathname;
    document.querySelectorAll('.nav-link').forEach(link => {
        if (link.getAttribute('href') === currentPath) {
            link.classList.add('active');
        }
    });
});
</script>

<!-- ðŸŒŸ Hero Section -->
<div class="hero-section mt-5 mb-5">
    <div class="hero-text">
        <h2 class="mb-4">Welcome to <span class="fw-bold text-anemo-red">AnemoCheck</span></h2>
        <p style="text-align: justify; text-indent: 1.5em;">
        AnemoCheck is an AI-powered anemia detection and classification system that analyzes your
        CBC results with high accuracy. Monitor your blood health and gain valuable insights in seconds.
        </p>


        <p style="text-align: justify; text-indent: 1.5em;">
            Discover health patterns, visualize progress, and make informed medical decisions
            â€” all through a secure, intelligent platform designed for better wellness.
        </p>

        {% if not current_user.is_authenticated %}
        <!-- CTA Button to Open Modal -->
        <button class="btn btn-primary btn-lg mt-3" data-bs-toggle="modal" data-bs-target="#cbcModal">
            Check your Status!
        </button>
        {% endif %}
    </div>

    <div class="hero-img mt-4 mt-md-0">
        <img src="https://images.unsplash.com/photo-1588776814546-1ffcf47267a5?auto=format&fit=crop&w=1000&q=80"
             alt="Anemia Detection">
    </div>
</div>

{% if not current_user.is_authenticated %}
<!-- ðŸ§ª Modal for CBC Input -->
<div class="modal fade" id="cbcModal" tabindex="-1" aria-labelledby="cbcModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content shadow-lg">
            <!-- ðŸ”´ Red Header -->
            <div class="modal-header" style="background-color: #c62828; color: white;">
                <h5 class="modal-title fw-bold" id="cbcModalLabel">Anemia Detection</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <form id="homeCbcForm" action="{{ url_for('xgb_try_clasify') }}" method="post" novalidate>
                    {{ form.hidden_tag() }}
                    <div class="row">
                        <!-- Left Column -->
                        <div class="col-md-6">
                            {% for label, id, name, placeholder in [
                                ('Age', 'age', 'age', 'Enter Age'),
                                ('Gender', 'gender', 'gender', 'Select Gender'),
                                ('White Blood Cell Count (WBC) (10Â³/ÂµL)', 'wbc', 'WBC', 'Enter WBC'),
                                ('Red Blood Cell Count (RBC) (million/ÂµL)', 'rbc', 'RBC', 'Enter RBC'),
                                ('Hemoglobin (g/dL)', 'hemoglobin', 'HEMOGLOBIN', 'Enter Hemoglobin'),
                                ('Hematocrit (%)', 'hematocrit', 'HEMATOCRIT', 'Enter Hematocrit'),
                                ('Mean Corpuscular Volume (MCV) (fL)', 'mcv', 'MCV', 'Enter MCV'),
                                ('Mean Corpuscular Hemoglobin (MCH) (pg)', 'mch', 'MCH', 'Enter MCH')
                            ] %}
                                <div class="mb-3">
                                    <label class="form-label fw-semibold" for="{{ id }}">{{ label }}</label>
                                    {% if id == 'gender' %}
                                        <select class="form-control" id="gender" name="gender" required>
                                            <option value="" disabled selected>{{ placeholder }}</option>
                                            <option value="male">Male</option>
                                            <option value="female">Female</option>
                                        </select>
                                        <div class="invalid-feedback">Gender is required.</div>
                                    {% else %}
                                        <input class="form-control" id="{{ id }}" name="{{ name }}" type="number" step="any" required placeholder="{{ placeholder }}" autocomplete="off">
                                        <div class="invalid-feedback">{{ label.split('(')[0].strip() }} is required.</div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>

                        <!-- Right Column -->
                        <div class="col-md-6">
                            {% for label, id, name, placeholder in [
                                ('MCHC (g/dL)', 'mchc', 'MCHC', 'Enter MCHC'),
                                ('Platelet Count (10Â³/ÂµL)', 'plt', 'PLATELET', 'Enter Platelet Count'),
                                ('Neutrophils (%)', 'neutrophils', 'NEUTROPHILS', 'Enter Neutrophils'),
                                ('Lymphocytes (%)', 'lymphocytes', 'LYMPHOCYTES', 'Enter Lymphocytes'),
                                ('Monocytes (%)', 'monocytes', 'MONOCYTES', 'Enter Monocytes'),
                                ('Eosinophils (%)', 'eosinophils', 'EUSONIPHILS', 'Enter Eosinophils'),
                                ('Basophils (%)', 'basophil', 'BASOPHIL', 'Enter Basophils'),
                                ('Immature Granulocytes (%)', 'immature_granulocytes', 'IMMATURE_GRANYTES', 'Enter Immature Granulocytes (optional)')
                            ] %}
                                <div class="mb-3">
                                    <label class="form-label fw-semibold" for="{{ id }}">{{ label }}</label>
                                    {% if id == 'immature_granulocytes' %}
                                        <input class="form-control" id="{{ id }}" name="{{ name }}" type="number" step="any" placeholder="{{ placeholder }}" autocomplete="off">
                                        <div class="form-text">If left blank, a default of 0.8 will be used.</div>
                                    {% else %}
                                        <input class="form-control" id="{{ id }}" name="{{ name }}" type="number" step="any" required placeholder="{{ placeholder }}" autocomplete="off">
                                        <div class="invalid-feedback">{{ label.split('(')[0].strip() }} is required.</div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="modal-footer mt-3">
                        <button type="submit" name="submit" class="btn btn-danger px-4">Submit</button>
                        <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endif %}
<script>
// Basic client-side validation similar to dashboard behavior
(function() {
    const form = document.getElementById('homeCbcForm');
    if (!form) return;
    const modalEl = document.getElementById('cbcModal');
    const requiredIds = [
        'wbc','rbc','hemoglobin','hematocrit','mcv','mch',
        'mchc','plt','neutrophils','lymphocytes','monocytes','eosinophils','basophil','gender'
    ];
    function setInvalid(el, msg) {
        el.classList.add('is-invalid');
        const fb = el.parentElement.querySelector('.invalid-feedback');
        if (fb && msg) fb.textContent = msg;
    }
    function clearInvalid(el) {
        el.classList.remove('is-invalid');
    }
    form.addEventListener('submit', function(e) {
        let valid = true;
        requiredIds.forEach(function(id) {
            const el = document.getElementById(id);
            if (!el) return;
            const val = (el.value || '').toString().trim();
            if (!val) {
                valid = false;
                const labelMap = {
                    'wbc':'WBC','rbc':'RBC','hemoglobin':'HEMOGLOBIN',
                    'hematocrit':'HEMATOCRIT','mcv':'MCV','mch':'MCH','mchc':'MCHC',
                    'plt':'PLATELET','neutrophils':'NEUTROPHILS','lymphocytes':'LYMPHOCYTES',
                    'monocytes':'MONOCYTES','eosinophils':'EUSONIPHILS','basophil':'BASOPHIL',
                    'gender':'Gender'
                };
                const msg = (labelMap[id] || 'Field') + ' is required.';
                setInvalid(el, msg);
            } else {
                clearInvalid(el);
            }
        });
        // Default immature granulocytes to 0.8 if empty
        const ig = document.getElementById('immature_granulocytes');
        if (ig && (ig.value === null || ig.value === undefined || ig.value.toString().trim() === '')) {
            ig.value = '0.8';
        }
        if (!valid) {
            e.preventDefault();
            e.stopPropagation();
            // Scroll to first invalid
            const firstInvalid = form.querySelector('.is-invalid');
            if (firstInvalid && firstInvalid.scrollIntoView) firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    });
    // Clear error on input
    requiredIds.forEach(function(id) {
        const el = document.getElementById(id);
        if (!el) return;
        el.addEventListener('input', function() { clearInvalid(el); });
        el.addEventListener('change', function() { clearInvalid(el); });
    });

    // Reset the form each time the modal is opened or closed so visitors always start fresh
    function resetVisitorForm() {
        form.reset();
        // Remove any is-invalid classes
        const invalids = form.querySelectorAll('.is-invalid');
        invalids.forEach(function(el) { el.classList.remove('is-invalid'); });
        // Clear any custom IG default we might have set previously
        const ig = document.getElementById('immature_granulocytes');
        if (ig) ig.value = '';
    }
    if (modalEl) {
        modalEl.addEventListener('show.bs.modal', resetVisitorForm);
        modalEl.addEventListener('hidden.bs.modal', resetVisitorForm);
    }
})();
</script>

<!-- ðŸ’Ž Features Section -->
<div class="row text-center mb-5">
    <div class="col-md-4 mb-4">
        <div class="card card-modern h-100 p-3">
            <img src="https://images.unsplash.com/photo-1581090700227-1e37b190418e?auto=format&fit=crop&w=800&q=80" alt="Track History" class="feature-image">
            <div class="card-body">
                <i class="fas fa-history fa-3x text-primary mb-3"></i>
                <h4 class="card-title fw-bold">Track Your History</h4>
                <p class="card-text text-muted">
                    Maintain a detailed record of your CBC results and monitor progress over time effortlessly.
                </p>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-4">
        <div class="card card-modern h-100 p-3">
            <img src="https://images.unsplash.com/photo-1584036561566-baf8f5f1b144?auto=format&fit=crop&w=800&q=80" alt="Visualize Trends" class="feature-image">
            <div class="card-body">
                <i class="fas fa-chart-line fa-3x text-primary mb-3"></i>
                <h4 class="card-title fw-bold">Visualize Trends</h4>
                <p class="card-text text-muted">
                    Explore interactive charts and identify trends in your hemoglobin levels over time.
                </p>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-4">
        <div class="card card-modern h-100 p-3">
            <img src="{{ url_for('static', filename='assets/1.jpg') }}" 
                 alt="Medical Recommendations" 
                 class="img-fluid feature-image mb-3">
            <div class="card-body">
                <i class="fas fa-clipboard-list fa-3x text-primary mb-3"></i>
                <h4 class="card-title fw-bold">Medical Recommendations</h4>
                <p class="card-text text-muted">
                    Receive AI-driven recommendations aligned with WHO anemia severity guidelines.
                </p>
            </div>
        </div>
    </div>
</div>

{% endblock %}
